{% extends "base.html" %}

{% block title %}Relatórios - CONNUT{% endblock %}

{% block content %}
<div class="container mx-auto p-4">
    <div id="cliente-selection" class="bg-white rounded-lg shadow-md p-6 mt-4">
        <h2 class="text-2xl font-bold mb-4 text-center text-gray-800">Selecione o Cliente para o Relatório</h2>
        <form method="POST" action="{{ url_for('relatorios') }}">
            <select id="cliente-select" name="cliente" class="w-full p-2 border border-gray-300 rounded mb-4">
                <option value="">Selecione um cliente...</option>
                {% for cliente in clientes %}
                <option value="{{ cliente.id }}" {% if cliente_selecionado and cliente_selecionado.id == cliente.id %}selected{% endif %}>
                    {{ cliente.nome }}
                </option>
                {% endfor %}
            </select>
            <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition duration-300">
                Gerar Relatório
            </button>
        </form>
        <a href="{{ url_for('index') }}" class="inline-block mt-4 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded transition duration-300">
            Voltar para o Menu Principal
        </a>
    </div>

    {% if relatorio %}
    <div id="relatorio" class="bg-white rounded-lg shadow-md p-6 mt-4">
        <h2 class="text-2xl font-bold mb-4">Relatório para {{ relatorio.nome_cliente }}</h2>
        <p class="mb-2">Total de Checklists: {{ relatorio.total_checklists }}</p>
        <p class="mb-2">Média de Conformidade: {{ relatorio.media_conformidade }}%</p>
        <p class="mb-4">Total de Documentos: {{ relatorio.total_documentos }}</p>
        
        <h3 class="text-xl font-bold mb-2">Checklists</h3>
        <ul class="list-disc pl-5 mb-4">
        {% for checklist in relatorio.checklists %}
            <li>
                Data: {{ checklist.data_inspecao.strftime('%d/%m/%Y') }} - 
                Área: {{ checklist.area_observada }} - 
                Conformidade: {{ checklist.porcentagem_conformidade }}%
            </li>
        {% endfor %}
        </ul>
        
        <h3 class="text-xl font-bold mb-2">Documentos</h3>
        <ul class="list-disc pl-5">
        {% for documento in relatorio.documentos %}
            <li>{{ documento.nome }} ({{ documento.tipo_arquivo }})</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>
{% endblock %}